server {
    # Define the server name (domain) for this configuration.
    server_name draftempire.win www.draftempire.win;

    # The server listens on port 80 (standard HTTP port)
    listen 80;

    # All requests to paths starting with /api will be handled here.
    location /api {
        # Forward requests to the Flask backend, which is served internally on port 5000.
        proxy_pass http://backend:5000;
        # Set various headers to pass along useful information to the backend.

        # Pass the original Host header from the client to the backend.
        proxy_set_header Host $host;
        # Pass the real client IP to the backend.
        proxy_set_header X-Real-IP $remote_addr;
        # Pass the chain of client IPs in case there are multiple proxies.
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        # Pass the protocol (HTTP or HTTPS) used by the client.
        proxy_set_header X-Forwarded-Proto $scheme;
    }

    # All requests not starting with /api will be handled here (typically for serving the frontend).
    location / {
        # Forward requests to the React frontend, which is served internally on port 80.
        proxy_pass http://frontend:80;
        # Similar to the /api block, forward headers to the frontend.

        # Pass the original Host header.
        proxy_set_header Host $host;
        # Pass the real client IP.
        proxy_set_header X-Real-IP $remote_addr;
        # Pass the chain of client IPs.
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        # Pass the protocol (HTTP or HTTPS).
        proxy_set_header X-Forwarded-Proto $scheme;
    }
}